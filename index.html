<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MQTT Control</title>
    <script src="https://cdn.jsdelivr.net/npm/mqtt@4.2.3/dist/mqtt.min.js"></script>
</head>
<body>
    <h1>MQTT Control</h1>
    <button id="connectButton">Connect MQTT</button>
    <div id="status">Status: Disconnected</div>

    <script>
        // Địa chỉ WebSocket Secure (WSS)
        const mqttBrokerUrl = 'wss://192.168.0.105:9883'; // Thay bằng URL và port của broker MQTT của bạn

        let client;

        // Hàm kết nối MQTT
        function connectMQTT() {
            // Tạo kết nối MQTT với broker qua WSS
            client = mqtt.connect(mqttBrokerUrl, {
                clientId: 'mqtt-client-' + Math.random().toString(16).substr(2, 8), // Tạo clientId ngẫu nhiên
                clean: true,
            });

            // Khi kết nối thành công
            client.on('connect', function () {
                console.log('Connected to MQTT Broker');
                document.getElementById('status').innerText = 'Status: Connected';

                // Subscribe vào một topic ví dụ
                client.subscribe('your/topic', function (err) {
                    if (err) {
                        console.log('Failed to subscribe:', err);
                    } else {
                        console.log('Subscribed to topic');
                    }
                });
            });

            // Khi nhận được thông điệp
            client.on('message', function (topic, message) {
                console.log('Message received:', topic, message.toString());
            });

            // Khi có lỗi kết nối
            client.on('error', function (error) {
                console.log('MQTT connection error:', error);
                document.getElementById('status').innerText = 'Status: Connection Error';
            });

            // Khi ngắt kết nối
            client.on('close', function () {
                console.log('Disconnected from MQTT Broker');
                document.getElementById('status').innerText = 'Status: Disconnected';
            });
        }

        // Gán sự kiện cho nút "Connect"
        document.getElementById('connectButton').addEventListener('click', connectMQTT);
    </script>
</body>
</html>
